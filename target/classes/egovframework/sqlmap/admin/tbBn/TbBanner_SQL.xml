<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="TbPopup">

	<typeAlias alias="egovMap"
		type="org.egovframe.rte.psl.dataaccess.util.EgovMap" />
	<typeAlias alias="tbPopupSerarchVO" type="dlink_new.admin.vo.TbBannerVO" />

	<resultMap id="tbBannerVO" class="dlink_new.admin.vo.TbBannerVO">
		<result property="popSeq" column="POP_SEQ" columnIndex="1" />
		<result property="popGubun" column="POP_GUBUN" columnIndex="2" />
		<result property="title" column="TITLE" columnIndex="3" />
		<result property="contents" column="CONTENTS" columnIndex="4" />
		<result property="fileSeq" column="FILE_SEQ" columnIndex="5" />
		<result property="linkUrl" column="LINK_URL" columnIndex="6" />
		<result property="useYn" column="USE_YN" columnIndex="7" />
		<result property="startDate" column="START_DATE" columnIndex="8" />
		<result property="endDate" column="END_DATE" columnIndex="9" />
		<result property="target" column="TARGET" columnIndex="10" />
		<result property="orderNo" column="ORDER_NO" columnIndex="11" />
		<result property="popupWidth" column="POPUP_WIDTH" columnIndex="12" />
		<result property="popupHeight" column="POPUP_HEIGHT" columnIndex="13" />
		<result property="regId" column="REG_ID" columnIndex="14" />
		<result property="regDate" column="REG_DATE" columnIndex="15" />
		<result property="modId" column="MOD_ID" columnIndex="16" />
		<result property="modDate" column="MOD_DATE" columnIndex="17" />
		<result property="fileNm" column="FILE_NM" columnIndex="17" />
	</resultMap>

	<insert id="tbPopupDAO.insertTbBanner">
		<![CDATA[
			INSERT INTO tb_popup 
				( POP_GUBUN
				  , TITLE
				  , CONTENTS
				  , FILE_SEQ
				  , USE_YN
				  , REG_ID
				  , REG_DATE )
			VALUES (  #popGubun#
				  , #title#
				  , #contents#
				  , #fileSeq#
				  , #useYn#
				  , #regId#
				  , now() )
		]]>
	</insert>

	<update id="tbPopupDAO.updateTbPopup_S">
		<![CDATA[
			UPDATE tb_popup
			SET 
				TITLE=#title#
				, CONTENTS=#contents#
				, FILE_SEQ=#fileSeq#
				, USE_YN=#useYn#
				, MOD_ID=#modId#
				, MOD_DATE=now()
			WHERE 1=1
			AND POP_SEQ = #popSeq#
			]]>
	</update>

	<delete id="tbPopupDAO.deleteTbPopup_S">
		<![CDATA[
			DELETE FROM tb_popup
			WHERE 1=1
			AND POP_SEQ = #popSeq#
			]]>
	</delete>

	<select id="tbPopupDAO.selectTbPopup_S" resultMap="tbBannerVO">
		<![CDATA[
			SELECT
				POP_SEQ
				, POP_GUBUN
				, TITLE
				, CONTENTS
				, FILE_SEQ
				, LINK_URL
				, USE_YN
				, START_DATE
				, END_DATE
				, TARGET
				, ORDER_NO
				, POPUP_WIDTH
				, POPUP_HEIGHT
				, REG_ID
				, DATE_FORMAT(REG_DATE, '%Y-%m-%d') REG_DATE
				, MOD_ID
				, MOD_DATE
				, (SELECT FILE_NM FROM tb_att_file B WHERE A.FILE_SEQ = B.FILE_SEQ) FILE_NM
			FROM tb_popup A
			]]>
			WHERE 1=1
			AND POP_SEQ = #popSeq#
	</select>

	<select id="tbPopupDAO.selectTbBannerList_D" parameterClass="tbPopupSerarchVO" resultClass="egovMap">
		 SELECT *
		   	FROM (
		           SELECT @ROWNUM := @ROWNUM + 1 AS RN	
					, POP_SEQ
					, POP_GUBUN
					, TITLE
					, CONTENTS
					, FILE_SEQ
					, LINK_URL
					, USE_YN
					, START_DATE
					, END_DATE
					, TARGET
					, ORDER_NO
					, POPUP_WIDTH
					, POPUP_HEIGHT
					, REG_ID
					, DATE_FORMAT(REG_DATE, '%Y-%m-%d') REG_DATE
					, MOD_ID
					, MOD_DATE
					FROM tb_popup B, (SELECT @ROWNUM:=0) RN_TB
				WHERE 1=1
				AND POP_GUBUN = 'B'
				<isNotEmpty property="searchKeyword" >
					AND B.TITLE LIKE CONCAT('%',#searchKeyword#,'%')
				</isNotEmpty>
				  ) A
		ORDER BY RN DESC
		limit #firstIndex#, #recordCountPerPage#
	</select>
	<select id="tbPopupDAO.selectTbPopupListTotCnt_S" parameterClass="tbPopupSerarchVO" resultClass="int">
		SELECT COUNT(*) totcnt
		FROM tb_popup
		WHERE 1=1
		AND POP_GUBUN = 'B'
		<isNotEmpty property="searchKeyword" >
			AND TITLE LIKE CONCAT('%',#searchKeyword#,'%')
		</isNotEmpty>
	</select>
	
	<select id="tbPopupDAO.selectMainBannerList" parameterClass="tbPopupSerarchVO" resultClass="egovMap">
           SELECT POP_SEQ
			, POP_GUBUN
			, TITLE
			, CONTENTS
			, FILE_SEQ
			, LINK_URL
			, USE_YN
			, START_DATE
			, END_DATE
			, TARGET
			, ORDER_NO
			, POPUP_WIDTH
			, POPUP_HEIGHT
			, REG_ID
			, DATE_FORMAT(REG_DATE, '%Y-%m-%d') REG_DATE
			, MOD_ID
			, MOD_DATE
			FROM tb_popup 
		WHERE 1=1
		AND POP_GUBUN = 'B'
		AND USE_YN = 'Y'
		ORDER BY POP_SEQ DESC
		LIMIT 3
	</select>

</sqlMap>
